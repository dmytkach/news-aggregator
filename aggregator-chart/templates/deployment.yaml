apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ .Values.deployment.name }}
  namespace: {{ .Values.namespace }}
  labels:
    app: {{ .Values.app.name }}
spec:
  replicas: {{ .Values.replicas }}
  selector:
    matchLabels:
      app: {{ .Values.app.name }}
  template:
    metadata:
      labels:
        app: {{ .Values.app.name }}
    spec:
      serviceAccountName: {{ .Values.serviceAccount.name }}
      containers:
        - name: {{ .Values.app.name }}
          image: {{ .Values.image.repository }}:{{ .Values.image.tag }}
          ports:
              - containerPort: {{ .Values.containerPort }}
          args:
            - "-port=:{{ .Values.containerPort }}"
            - "-cert=./server/certificates/cert.pem"
            - "-key=./server/certificates/key.pem"
            - "-path-to-source=/mnt/sources/sources.json"
            - "-news-folder=/mnt/news"
          volumeMounts:
            - name: news-volume
              mountPath: "/mnt/news"
            - name: sources-volume
              mountPath: "/mnt/sources"
      volumes:
        - name: news-volume
          persistentVolumeClaim:
            claimName: {{ .Values.persistentVolumeClaim.news }}
        - name: sources-volume
          persistentVolumeClaim:
            claimName: {{ .Values.persistentVolumeClaim.sources }}
